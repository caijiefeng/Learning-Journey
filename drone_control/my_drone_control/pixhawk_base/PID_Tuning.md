# 多旋翼飞行器PID整定

如果你使用的机架类型是PX4支持的机架类型（也就是能够直接在校准时候选择的那些机型），那么PX4会为你提供默认的PID参数，这些参数大部分时候都能够保证你安全正常的驾驶无人机。但是多数情况下还是建议重新对PID进行整定，因为哪怕你只是更换了小的部件都会对最佳飞行的收益产生影响（不同的电机、在机架上搭载了相机其他硬件等等）。

PX4提供了一个自动整定PID的选项，对于大部分的使用者来说这是一个不错的选择，但是对于我们这种当然是要手动整定了，否则也太lou了吧~~~

---

## PID介绍

PID是一种非常常用的控制算法，PX4使用PID算法来平衡设定值和响应值之间的误差，就是能够让无人机快速响应又不过冲。

PID的含义及整定方法：

* P（比例）/K：增大P以提高响应能力，减小P以防止响应过冲或者振荡。
* I（积分）：I用于减小稳态误差。响应无法达到设定值就增大，出现缓慢振荡就减小。
* D（微分）：增大D以抑制过冲或振荡（和减小P的效果相似），D根据需要增大非必要不要增大这个值，因为它会放大噪声还可能导致电机发热。

---

## QGC的PID Tuning图

QGC提供了一个PID整定的界面，如下：

![](https://docs.px4.io/main/assets/img/qgc_mc_pid_tuning_rate_controller.950965c8.png)

可以看到有4个控制器，高级别的控制器会把它的结果传递给低级别的控制器。最低级别的控制器是Rate Controller，接着是Attitude Controller，最高级别是Velocity/Position Controller。PID整定也需要从低级别到高级别，因为低级别控制器会影响所有控制器。

整定过程中，通过移动遥控器的roll、pitch、yaw杆来创建快速的设定点并观察响应曲线，进一步调整PID参数。

---

## Method1 of  PID Tuning

PX官方提供了一个base的PID调整方法，这个方法不推荐使用，有不小的安全隐患，所以调整的时候最好带上一个有手飞经验的飞手。切忌调整PID时大开大合，应该尽可能慢地调整。

具体步骤如下：

1. 修改`COM_DISARM_PRFLT`参数，确保电机在解锁后不会在自动上锁（这个时间设置为自己认为可完成PID整定的时间即可）。
2. 解锁电机（**一定要卸桨！！！**）将无人机绕roll、pitch、yaw旋转大概60度，确保电机不会自动上锁。
3. 上桨，解锁电机起飞并保持无人机悬停，确保无人机处在一个安全的位置（高度适当，距离人远点）。
4. 打开QGC选择**Vehicle-Setup -> PID Tuning**，选择**Rate Controller**（需要切换到手动模式），并把左上角`airmod`设为**Disabled**。
5. 将`Thrust curve`设置为0.3（PWM，后续可根据需要调整到最优）或者1（RPM，不用再修改）。默认这个值为0，一般不推荐改，基本也都不需要改。
6. 选择**roll**，并且推动遥控器上的roll摇杆观察响应曲线以及setpoint曲线，根据实际情况调整PID。
7. 通常**roll**的PID也适用于**pitch**和**yaw**，也可以自己再整定，步骤一样的。
8. 接着选择**Attitude Controller**重复上述步骤。
9. 最后选择**Velocity Controller**和**Positions controller**，切换到position模式，并且将`Position control mode`切换到**Simple position control**，接着开始调整水平和垂直方向的PID。
10. 到这里，PID整定结束，将`airmod`设置为**enable**。

再说一遍，这种方法不推荐，调试前确保你手飞技术足够稳。